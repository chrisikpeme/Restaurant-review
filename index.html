<!-- build: ui13 (no zero option; 10→1; mobile 5×2; Food60/others10; robust reset) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Restaurant'O'Meter</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<style>
  :root{--bg:#0b1022;--card:#0f172a;--ink:#e6edf3;--mut:#9fb0c3;--line:#213047;--accent:#10b981;--chip:#0a1122}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
  h1{margin:0 0 6px;font-size:24px}
  h2{margin:18px 0 8px;font-size:16px;color:var(--mut)}
  label{display:block;margin:8px 0 4px}
  input,textarea,button{font:inherit}
  input,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:var(--chip);color:var(--ink)}
  textarea{min-height:84px}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .g12{grid-column:span 12}.g8{grid-column:span 8}.g6{grid-column:span 6}.g4{grid-column:span 4}.g3{grid-column:span 3}
  @media(max-width:860px){.g8,.g6,.g4,.g3{grid-column:span 12}}

  /* Score chips: 10 across on wide; 5×2 on small */
  .chips{display:grid;grid-template-columns:repeat(10,1fr);gap:8px;align-items:center}
  @media(max-width:540px){.chips{grid-template-columns:repeat(5,1fr)}}
  .chip{
    display:inline-flex;align-items:center;justify-content:center;width:100%;height:42px;
    border:1px solid var(--line);border-radius:10px;background:var(--chip);color:var(--ink);
    cursor:pointer;transition:.12s
  }
  .chip:hover{transform:translateY(-1px)}
  .chip[aria-pressed="true"]{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent) inset;background:#0e1b16}
  @media(max-width:540px){ .chip{height:38px;font-size:14px} }

  .mut{color:var(--mut);font-size:14px}
  .desc{font-weight:700;margin-top:4px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{border:1px solid var(--line);background:var(--chip);color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer}
  button.primary{border-color:var(--accent)}
  button[disabled]{opacity:.6;cursor:not-allowed}

  /* Overall bar: single solid colour */
  progress{
    -webkit-appearance:none;appearance:none;width:100%;height:12px;
    border:1px solid var(--line);border-radius:999px;background:#0a1122;overflow:hidden;--bar-color:#ef4444;
  }
  progress::-webkit-progress-bar{background:#0a1122;border-radius:999px}
  progress::-webkit-progress-value{background:var(--bar-color)!important;border-radius:999px}
  progress::-moz-progress-bar{background:var(--bar-color)!important;border-radius:999px}

  .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);
         background:#0f1f16;border:1px solid #183f31;color:#c7ffdf;padding:10px 14px;border-radius:10px;opacity:0;transition:.2s}
  .toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Restaurant-Review-Ometer</h1>

    <div class="grid" style="margin-top:10px">
      <div class="g6"><label>Restaurant</label><input id="restaurant" placeholder="e.g., Test Bistro"></div>
      <div class="g3"><label>City</label><input id="city" placeholder="City"></div>
      <div class="g3"><label>Date</label><input id="date" type="date"></div>
      <div class="g6"><label>Reviewer</label><input id="reviewer" placeholder="Your name"></div>
      <div class="g6"><label>Notes</label><textarea id="notes" placeholder="Highlights, weaknesses, dishes to remember…"></textarea></div>
    </div>

    <h2>Categories</h2>
    <div id="cats"></div>

    <h2>Overall result</h2>
    <div class="grid">
      <div class="g8">
        <div class="row"><strong>Weighted Overall:</strong>
          <span id="overall" style="margin-left:6px">0.0</span> / 10 — <span id="band" class="mut">—</span>
        </div>
        <progress id="bar" max="10" value="0"></progress>
        <div class="mut">
          Banding: 9.5–10 Elite · 8.5–9.4 Outstanding · 7.5–8.4 Excellent · 6.5–7.4 Good ·
          5.0–6.4 Mixed · 2.5–4.9 Poor · &lt;2.5 Tragic.
        </div>
      </div>
      <div class="g4" style="display:flex;align-items:flex-end">
        <button id="syncBtn" class="primary" style="width:100%">Submit review</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">Synced!</div>

<script>
/* Hard-coded endpoint */
const ENDPOINT='https://api.sheetbest.com/sheets/9707a268-edd0-4f09-afe3-3f430786e8e2';
const APIKEY='';

/* Weights (Food 60; others 10) */
const CATS=[
  {key:'Food',label:'Food · 60%',w:0.60,help:'Technique, flavour clarity, balance, execution'},
  {key:'Service',label:'Service · 10%',w:0.10,help:'Warmth, timing, product knowledge, problem-solving'},
  {key:'Ambience',label:'Ambience · 10%',w:0.10,help:'Comfort, acoustics, lighting, character'},
  {key:'Drinks',label:'Drinks · 10%',w:0.10,help:'Breadth, curation, pairing, pricing'},
  {key:'Value',label:'Value · 10%',w:0.10,help:'Price fairness vs quality and experience'}
];

/* Descriptors (1–10 only; no zero option) */
const DESCR={
  Food:{
    10:'Unforgettable: Last Supper territory, something you will talk about for years',
     9:'Outstanding: full of passion, precision, excitement.',
     8:'Excellent: creative, balanced, dishes that delight.',
     7:'Impressive: clear skill, flavours that stand out',
     6:'Tasty: well made, enjoyable',
     5:'Honest: straightforward, gets the job done',
     4:'Boring: safe and predictable, lacks spark',
     3:'Poor: edible but bland, no real skill',
     2:'Dreadful: clumsy, careless, no pleasure in eating',
     1:'Dire: badly cooked, shouldn’t be served'
  },
  Service:{
    10:'Brilliant: unobtrusive service that lifts the whole experience.',
     9:'Great: natural, intuitive, makes the night flow',
     8:'Helpful: good suggestions, small thoughtful touches',
     7:'Smooth: confident, good timing, feels relaxed',
     6:'Friendly: warm, attentive, knows the menu',
     5:'Functional: the basics done, nothing more',
     4:'Flat: polite but lifeless',
     3:'Slack: careless, repeated mistakes',
     2:'Chaotic: lost, slow, visibly untrained',
     1:'Rude: actively unpleasant'
  },
  Ambience:{
    10:'Special: a setting that becomes part of the memory',
     9:'Lovely: atmosphere adds real joy to the night',
     8:'Characterful: charm and individuality',
     7:'Attractive: stylish, feels good to be in',
     6:'Pleasant: comfortable, easy to enjoy',
     5:'Forgettable: neat but generic, doesn’t stick with you',
     4:'Basic: tidy but uninspired',
     3:'Dull: plain, no personality',
     2:'Harsh: cramped, noisy, uncomfortable',
     1:'Awful: dirty, oppressive, or chaotic'
  },
  Drinks:{
    10:'Fantastic: list that excites — brilliant wines, local treasures, fair mark-ups, options for all tastes',
     9:'Great: mix of classics and local gems, fair pricing',
     8:'Excellent: thoughtful list, some discoveries, good by-the-glass',
     7:'Strong: well-chosen, fair value, interesting variety',
     6:'Good: balanced, reliable, honest mark-ups',
     5:'Decent: everyday options, fair prices',
     4:'Basic: workable list, covers the essentials',
     3:'Poor: narrow, generic, uninspired',
     2:'Dire: thin list, poor quality, overpriced',
     1:'Rip-off: bad choices, silly mark-ups'
  },
  Value:{
    10:'Spot-on: bill feels completely right, maybe even generous',
     9:'Great value: delivers more than expected',
     8:'Very good: feels generous for the quality',
     7:'Good: you leave happy with the spend',
     6:'Fair: matches expectations, no sting',
     5:'Reasonable: fair, nothing generous',
     4:'Unbalanced: OK meal, not worth the price',
     3:'Disappointing: food fine, bill unfair',
     2:'Very poor: inflated cost, weak return',
     1:'Insulting: outrageous for what’s delivered'
  }
};

const scores={}; const $=id=>document.getElementById(id); const n=x=>Number(x)||0;

/* Colour helper: red→amber→green single tone */
function lerp(a,b,t){return Math.round(a+(b-a)*t)}
function blend(c1,c2,t){const a=[parseInt(c1.slice(1,3),16),parseInt(c1.slice(3,5),16),parseInt(c1.slice(5,7),16)];
  const b=[parseInt(c2.slice(1,3),16),parseInt(c2.slice(3,5),16),parseInt(c2.slice(5,7),16)];
  const r=lerp(a[0],b[0],t), g=lerp(a[1],b[1],t), bl=lerp(a[2],b[2],t); return `rgb(${r},${g},${bl})`;}
function ratingColor(score){const t=Math.max(0,Math.min(1,score/10)); return (t<=0.5)?blend('#ef4444','#f59e0b',t/0.5):blend('#f59e0b','#10b981',(t-0.5)/0.5);}

/* Banding */
function bandFor(o){
  return (o>=9.5)?'Elite by any measure'
       :(o>=8.5)?'Outstanding; destination dining'
       :(o>=7.5)?'Excellent; a clear standout'
       :(o>=6.5)?'Good'
       :(o>=5.0)?'Mixed'
       :(o>=2.5)?'Poor'
       :'Tragic';
}

/* Toast helpers */
function toast(msg, ms=1600){
  const t=$('toast'); t.textContent=msg; t.classList.add('show');
  clearTimeout(t._tid); if(ms>0){ t._tid=setTimeout(()=>t.classList.remove('show'), ms); }
}
function toastStep(msg, ms){ return new Promise(res=>{ toast(msg, ms); setTimeout(res, ms); }); }

/* Build category sections */
function mkChips(cat){
  const wrap=document.createElement('div');
  wrap.className='card'; wrap.style.padding='12px'; wrap.style.margin='10px 0';
  wrap.innerHTML=`<div class="grid">
    <div class="g12"><strong>${cat.label}</strong></div>
    <div class="g12 mut" id="help-${cat.key}">${cat.help}</div>
    <div class="g12 chips" id="chips-${cat.key}"></div>
    <div class="g12 desc" id="desc-${cat.key}"></div>
  </div>`;
  const row=wrap.querySelector('#chips-'+cat.key);
  const descEl=wrap.querySelector('#desc-'+cat.key);
  for(let i=10;i>=1;i--){  /* 10 → 1 (no zero) */
    const b=document.createElement('button');
    b.className='chip'; b.textContent=String(i); b.setAttribute('aria-pressed','false');
    b.addEventListener('click',()=>{
      scores[cat.key]=i;
      [...row.children].forEach(x=>x.setAttribute('aria-pressed','false'));
      b.setAttribute('aria-pressed','true');
      const txt=(DESCR[cat.key] && DESCR[cat.key][i]!=null)?DESCR[cat.key][i]:'';
      descEl.textContent=txt;
      descEl.style.color=ratingColor(i);
      updateOverall();
    });
    row.appendChild(b);
  }
  return wrap;
}

function buildCats(){
  const root=$('cats'); root.innerHTML='';
  CATS.forEach(c=>root.appendChild(mkChips(c)));
}

/* Reset everything for next review */
function clearForm(){
  ['restaurant','city','reviewer','notes'].forEach(id=>$(id).value='');
  $('date').value=new Date().toISOString().slice(0,10);
  for(const k in scores) delete scores[k];
  buildCats();
  $('overall').textContent='0.0';
  $('bar').value=0;
  $('band').textContent='—';
}

/* Compute overall */
function updateOverall(){
  let total=0; CATS.forEach(c=> total+=n(scores[c.key])*c.w );
  const o=Math.round(total*10)/10;
  $('overall').textContent=o.toFixed(1);
  $('band').textContent=bandFor(o);
  const bar=$('bar'); bar.value=o; bar.style.setProperty('--bar-color', ratingColor(o));
}

/* Prepare payload */
function rowPayload(){
  return [{
    Timestamp:new Date().toISOString(),
    Date:$('date').value,
    Restaurant:$('restaurant').value.trim(),
    City:$('city').value.trim(),
    Reviewer:$('reviewer').value.trim(),
    Food:n(scores.Food), Service:n(scores.Service), Ambience:n(scores.Ambience),
    Drinks:n(scores.Drinks), Value:n(scores.Value),
    Overall:Number($('overall').textContent),
    Band:$('band').textContent,
    Notes:$('notes').value.trim(),
    UserAgent:navigator.userAgent
  }];
}

/* Submit with thanks → saved → clearing → reset */
async function sync(){
  const btn=$('syncBtn');
  const headers={'Content-Type':'application/json'};
  if(APIKEY){headers['X-API-KEY']=APIKEY; headers['Authorization']='Bearer '+APIKEY;}

  btn.disabled=true; btn.textContent='Submitting…';
  toast('Thanks for your review', 1200);

  try{
    const r=await fetch(ENDPOINT,{method:'POST',headers,body:JSON.stringify(rowPayload())});
    if(r.ok){
      await toastStep('Saved', 1100);
      await toastStep('Clearing form…', 900);
      clearForm();
    }else{
      alert('Sync failed: '+r.status);
    }
  }catch(e){
    alert('Network error');
  }finally{
    btn.disabled=false; btn.textContent='Submit review';
  }
}

/* Init */
$('date').value=new Date().toISOString().slice(0,10);
buildCats(); updateOverall();
$('syncBtn').addEventListener('click', sync);
</script>

<div id="toast" class="toast">Synced!</div>
</body>
</html>
