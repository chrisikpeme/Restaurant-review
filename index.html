<!-- build: ui8 (Dent+Rayner descriptors, solid bar, Mixed>=5, Poor>=2.5) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Restaurant-Review-Ometer</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<style>
  :root{--bg:#0b1022;--card:#0f172a;--ink:#e6edf3;--mut:#9fb0c3;--line:#213047;--accent:#10b981;--chip:#0a1122}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
  h1{margin:0 0 6px;font-size:24px}
  h2{margin:18px 0 8px;font-size:16px;color:var(--mut)}
  label{display:block;margin:8px 0 4px}
  input,textarea,button{font:inherit}
  input,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:var(--chip);color:var(--ink)}
  textarea{min-height:84px}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .g12{grid-column:span 12}.g8{grid-column:span 8}.g6{grid-column:span 6}.g4{grid-column:span 4}.g3{grid-column:span 3}
  @media(max-width:860px){.g8,.g6,.g4,.g3{grid-column:span 12}}

  /* Always-visible chips (no scroll) */
  .chips{display:grid;grid-template-columns:repeat(11, 1fr);gap:8px;align-items:center}
  .chip{
    display:inline-flex;align-items:center;justify-content:center;width:100%;height:42px;
    border:1px solid var(--line);border-radius:10px;background:var(--chip);color:var(--ink);
    cursor:pointer;transition:.12s
  }
  .chip:hover{transform:translateY(-1px)}
  .chip[aria-pressed="true"]{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent) inset;background:#0e1b16}
  @media(max-width:540px){ .chips{grid-template-columns:repeat(6,1fr)} .chip{height:38px;font-size:14px} }

  .mut{color:var(--mut);font-size:14px}
  .desc{font-weight:700;margin-top:4px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{border:1px solid var(--line);background:var(--chip);color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer}
  button.primary{border-color:var(--accent)}

  /* Overall bar: single solid colour controlled by JS */
  progress{
    -webkit-appearance:none;appearance:none;width:100%;height:12px;
    border:1px solid var(--line);border-radius:999px;background:#0a1122;overflow:hidden;
    --bar-color:#ef4444;
  }
  progress::-webkit-progress-bar{background:#0a1122;border-radius:999px}
  progress::-webkit-progress-value{background:var(--bar-color)!important;border-radius:999px}
  progress::-moz-progress-bar{background:var(--bar-color)!important;border-radius:999px}

  .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);
         background:#0f1f16;border:1px solid #183f31;color:#c7ffdf;padding:10px 14px;border-radius:10px;opacity:0;transition:.2s}
  .toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Restaurant-Review-Ometer</h1>

    <div class="grid" style="margin-top:10px">
      <div class="g6"><label>Restaurant</label><input id="restaurant" placeholder="e.g., Test Bistro"></div>
      <div class="g3"><label>City</label><input id="city" placeholder="City"></div>
      <div class="g3"><label>Date</label><input id="date" type="date"></div>
      <div class="g6"><label>Reviewer</label><input id="reviewer" placeholder="Your name"></div>
      <div class="g6"><label>Notes</label><textarea id="notes" placeholder="Highlights, weaknesses, dishes to remember…"></textarea></div>
    </div>

    <h2>Categories</h2>
    <div id="cats"></div>

    <h2>Overall result</h2>
    <div class="grid">
      <div class="g8">
        <div class="row"><strong>Weighted Overall:</strong>
          <span id="overall" style="margin-left:6px">0.0</span> / 10 — <span id="band" class="mut">—</span>
        </div>
        <progress id="bar" max="10" value="0"></progress>
        <div class="mut">
          Banding: 9.5–10 Elite · 8.5–9.4 Outstanding · 7.5–8.4 Excellent · 6.5–7.4 Good ·
          5.0–6.4 Mixed · 2.5–4.9 Poor · &lt;2.5 Tragic.
        </div>
      </div>
      <div class="g4" style="display:flex;align-items:flex-end">
        <button id="syncBtn" class="primary" style="width:100%">Submit review</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">Synced!</div>

<script>
/* Hard-coded endpoint */
const ENDPOINT='https://api.sheetbest.com/sheets/9707a268-edd0-4f09-afe3-3f430786e8e2';
const APIKEY='';

/* Categories + help */
const CATS=[
  {key:'Food',label:'Food · 67%',w:0.67,help:'Depth, clarity, seasoning, execution, balance'},
  {key:'Service',label:'Service · 10%',w:0.10,help:'Warmth, pace, accuracy, product knowledge'},
  {key:'Ambience',label:'Ambience · 7%',w:0.07,help:'Comfort, acoustics, lighting, character'},
  {key:'Drinks',label:'Drinks · 6%',w:0.06,help:'List breadth, curation, pricing, pairings'},
  {key:'Value',label:'Value · 5%',w:0.05,help:'Worth vs. experience and market peers'},
  {key:'Consistency',label:'Consistency · 5%',w:0.05,help:'Reliability across dishes/visits'}
];

/* Your Dent-ish descriptors (10→0) */
const DESCR={
  Food:{
    10:'Cooking to dream about for years.',
    9:'Exact, assured; flavours sing clearly.',
    8:'Characterful, inventive dishes that land.',
    7:'Good cooking with the odd wobble.',
    6:'Capable, cautious, soon forgotten.',
    5:'Patchy cooking; seasoning ropey.',
    4:'Sloppy edges; muddled, wandering flavours.',
    3:'Technique falters often.',
    2:'Errors dominate; appetite dwindles.',
    1:'Misses the point entirely.',
    0:'Food poisoning.'
  },
  Service:{
    10:'Seamless, discreet perfection.',
    9:'Pacing right; the room understood.',
    8:'Warm, alert; fixes made swiftly.',
    7:'Pleasant and mostly punctual.',
    6:'Functional, but nobody steering.',
    5:'Inconsistent; you’re kept waiting.',
    4:'Orders muddled; attention slips away.',
    3:'Slow, distracted; hard to get attention.',
    2:'Errors stack up; timing collapses.',
    1:'Indifferent, edging towards rude.',
    0:'Self-service.'
  },
  Ambience:{
    10:'Feels like it was made for us.',
    9:'Cohesive, calm, comfortably lit.',
    8:'Thoughtful touches; the space breathes.',
    7:'Pleasant, if a touch anonymous.',
    6:'Serviceable, short on charm.',
    5:'Tight tables or swelling noise.',
    4:'Glare, echo, draughts distract throughout.',
    3:'Drab but adequate.',
    2:'Scuffed, tired, a little harsh.',
    1:'Actively unpleasant.',
    0:'We left.'
  },
  Drinks:{
    10:'Exceptional list; pairings lift everything.',
    9:'Range with restraint; prices make sense.',
    8:'Good spread; choices feel considered.',
    7:'Decent selection but expensive.',
    6:'Short but workable.',
    5:'Narrow list or awkward pricing.',
    4:'Thin options; pairing feels guessed.',
    3:'Little here you actually want.',
    2:'Off-key and overpriced.',
    1:'Dire selection.',
    0:'No drinks served.'
  },
  Value:{
    10:'Remarkable for the money.',
    9:'Priced properly for what’s delivered.',
    8:'A little high, still fine.',
    7:'Good, but a couple of rip-off items.',
    6:'Cost outruns experience.',
    5:'Mixed value; a few winces.',
    4:'Often dearer than peers.',
    3:'The bill stings; joy doesn’t.',
    2:'Very bad value.',
    1:'Not worth even coming here.',
    0:'Free.'
  },
  Consistency:{
    10:'Every plate lands, every time.',
    9:'Barely a wobble.',
    8:'Steady with rare dips.',
    7:'Some good days, some shrugs.',
    6:'Often uneven.',
    5:'Hit and miss.',
    4:'Lapses you start to expect.',
    3:'Off the pace too often.',
    2:'Usually below its own best.',
    1:'Reliability missing.',
    0:'Fawlty Towers.'
  }
};

const scores={}; const $=id=>document.getElementById(id); const n=x=>Number(x)||0;

/* Colour helper: red→amber→green single tone */
function lerp(a,b,t){return Math.round(a+(b-a)*t)}
function blend(c1,c2,t){const a=[parseInt(c1.slice(1,3),16),parseInt(c1.slice(3,5),16),parseInt(c1.slice(5,7),16)];
  const b=[parseInt(c2.slice(1,3),16),parseInt(c2.slice(3,5),16),parseInt(c2.slice(5,7),16)];
  const r=lerp(a[0],b[0],t), g=lerp(a[1],b[1],t), bl=lerp(a[2],b[2],t); return `rgb(${r},${g},${bl})`;}
function ratingColor(score){const t=Math.max(0,Math.min(1,score/10)); return (t<=0.5)?blend('#ef4444','#f59e0b',t/0.5):blend('#f59e0b','#10b981',(t-0.5)/0.5);}

function bandFor(o){
  return (o>=9.5)?'Elite by any measure'
       :(o>=8.5)?'Outstanding; destination dining'
       :(o>=7.5)?'Excellent; a clear standout'
       :(o>=6.5)?'Good'
       :(o>=5.0)?'Mixed'
       :(o>=2.5)?'Poor'
       :'Tragic';
}

function updateOverall(){
  let total=0; CATS.forEach(c=> total+=n(scores[c.key])*c.w );
  const o=Math.round(total*10)/10;
  $('overall').textContent=o.toFixed(1);
  $('band').textContent=bandFor(o);
  const bar=$('bar'); bar.value=o; bar.style.setProperty('--bar-color', ratingColor(o));
}

function mkChips(cat){
  const wrap=document.createElement('div');
  wrap.className='card'; wrap.style.padding='12px'; wrap.style.margin='10px 0';
  wrap.innerHTML=`<div class="grid">
    <div class="g12"><strong>${cat.label}</strong></div>
    <div class="g12 mut" id="help-${cat.key}">${cat.help}</div>
    <div class="g12 chips" id="chips-${cat.key}"></div>
    <div class="g12 desc" id="desc-${cat.key}"></div>
  </div>`;
  const row=wrap.querySelector('#chips-'+cat.key);
  const descEl=wrap.querySelector('#desc-'+cat.key);
  for(let i=10;i>=0;i--){
    const b=document.createElement('button');
    b.className='chip'; b.textContent=String(i); b.setAttribute('aria-pressed','false');
    b.addEventListener('click',()=>{
      scores[cat.key]=i;
      [...row.children].forEach(x=>x.setAttribute('aria-pressed','false'));
      b.setAttribute('aria-pressed','true');
      const txt=(DESCR[cat.key] && DESCR[cat.key][i]!=null)?DESCR[cat.key][i]:'';
      descEl.textContent=txt;
      descEl.style.color=ratingColor(i);
      updateOverall();
    });
    row.appendChild(b);
  }
  return wrap;
}

function buildCats(){const root=$('cats'); CATS.forEach(c=>root.appendChild(mkChips(c)));}

function rowPayload(){
  return [{
    Timestamp:new Date().toISOString(),
    Date:$('date').value,
    Restaurant:$('restaurant').value.trim(),
    City:$('city').value.trim(),
    Reviewer:$('reviewer').value.trim(),
    Food:n(scores.Food), Service:n(scores.Service), Ambience:n(scores.Ambience),
    Drinks:n(scores.Drinks), Value:n(scores.Value), Consistency:n(scores.Consistency),
    Overall:Number($('overall').textContent),
    Band:$('band').textContent,
    Notes:$('notes').value.trim(),
    UserAgent:navigator.userAgent
  }];
}

function toast(msg){const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1600);}
async function sync(){
  const headers={'Content-Type':'application/json'};
  if(APIKEY){headers['X-API-KEY']=APIKEY; headers['Authorization']='Bearer '+APIKEY;}
  try{
    const r=await fetch(ENDPOINT,{method:'POST',headers,body:JSON.stringify(rowPayload())});
    if(r.ok){toast('Synced!');} else {alert('Sync failed: '+r.status);}
  }catch(e){alert('Network error');}
}

/* Init */
document.getElementById('date').value=new Date().toISOString().slice(0,10);
buildCats(); updateOverall();
document.getElementById('syncBtn').addEventListener('click', sync);
</script>

<div id="toast" class="toast">Synced!</div>
</body>
</html>
